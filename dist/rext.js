!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.rext=n()}(this,function(){"use strict";function e(e){var n=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,t=n.exec(window.location.href.toLowerCase())||[],r=n.exec(e.toLowerCase());return!(!r||r[1]===t[1]&&r[2]===t[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(t[3]||("http:"===t[1]?"80":"443")))}function n(){try{return new window.XMLHttpRequest}catch(e){}}function t(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function r(e){var n;if("text"!==e.responseType&&""!==e.responseType)return e.response;try{n=JSON.parse(e.responseText)}catch(t){n=e.responseText}return n}function o(e){var n=L({},I,e||{}),t=h(),o={success:e.success||arguments[1]||function(){},error:e.error||arguments[2]||function(){},always:e.always||arguments[3]||function(){}},a=_(),i=function(e,n){if(null!=i&&(4===a.readyState||n))if(delete P[t],i=undefined,a.onreadystatechange=null,n)4!==a.readyState&&a.abort();else{var s=r(a);a.status>=200&&a.status<300?o.success.call(o,s,a):o.error.call(o,s,a),o.always.call(o,s,a)}};a.open(n.type,n.url,!0),a.responseType=n.responseType;for(var s in n.headers)n.headers.hasOwnProperty(s)&&a.setRequestHeader(s,n.headers[s]);n.withCredentials&&(a.withCredentials=!0),a.send(/application\/json/i.test(n.headers["Content-type"])?JSON.stringify(n.data):X(n.data)),4===a.readyState?window.setTimeout(i):a.onreadystatechange=P[t]=i;var u={success:function(e){return o.success=e,u},error:function(e){return o.error=e,u},always:function(e){return o.always=e,u},abort:function(){i&&i(undefined,!0)}};return u}function a(e){var n;try{n=JSON.parse(e)}catch(t){n=e}return n}function i(e){if(e=L({},B,e||{}),q.test(e.type)&&U.test(e.url)&&k.test(e.url)){var n=(e.responseType||"json").toLowerCase(),t=new XDomainRequest;/^\d+$/.test(e.timeout)&&(t.timeout=e.timeout);var r={success:e.success||function(){},error:e.error||function(){},always:e.always||function(){}},o={success:function(e){return r.success=e,o},error:function(e){return r.error=e,o},always:function(e){return r.always=e,o},abort:function(){t.abort()}};return t.ontimeout=function(){r.error.call(r,null,{status:{code:500,message:"timeout"}})},t.onprogress=function(){},t.onload=function(){var e={code:200,message:"success"},o={headers:{"Content-Length":t.responseText.length,"Content-Type":t.contentType},text:t.responseText,data:a(t.responseText)};if("html"===n||/text\/html/i.test(t.contentType))o.data=t.responseText;else if("json"===n||"text"!==n&&/\/json/i.test(t.contentType))try{o.data=JSON.parse(t.responseText)}catch(s){e.code=500,e.message="parser error: invalid json"}else if("xml"===n||"text"!==n&&/\/xml/i.test(t.contentType)){var i=new ActiveXObject("Microsoft.XMLDOM");i.async="false";try{i.loadXML(t.responseText)}catch(s){i=undefined}i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||(e.code=500,e.message="parser error: invalid xml"),o.data=i}o.status=e,e.code>=200&&e.code<300?r.success.call(r,o.data,o):r.error.call(r,o.data,o),r.always.call(r,o.data,o)},t.onerror=function(){r.error.call(r,t.responseText,{status:{code:500,message:"error"},text:t.responseText})},t.open(e.type,e.url),window.setTimeout(function(){t.send(X(e.data))},0),o}}function s(e,n){var t="jsonp_"+String(1e3*(new Date).getTime()+Math.round(1e3*Math.random()));window[t]=n||e.callback;var r=window.document.getElementsByTagName("script")[0],o=window.document.createElement("script");if(o.src=e.url+(e.url.indexOf("?")>=0?"&":"?")+X(e.data)+"&callback="+t,r.parentNode.insertBefore(o,r),o.onload=o.onreadystatechange=function(){o.readyState&&!/loaded|complete/.test(o.readyState)||(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),o=null)},null==window[t])return function(e){window[t]=e}}function u(e){var n=window.document.createElement("a");return n.href=e,n.protocol+"//"+n.host}function c(e){return H[e]===undefined&&(H[e]=Y()),H[e]}function l(e){return $[e]===undefined&&($[e]=e+"/iframe-agent.html"),$[e]}function f(e){return"iframe-agent-"+c(e)}function d(e){var n=f(e),t=window.document.getElementById(n);t||((t=window.document.createElement("iframe")).id=n,t.style.display="none",window.document.body.appendChild(t));var r=l(e);return t.src!==r&&(t.src=r),t}function p(e,n,t,r){var o={type:"iframe-agent-request",origin:e,id:t,data:r};F[e]?n.contentWindow.postMessage(JSON.stringify(o),e):(V[e]||(V[e]=[]),V[e].push(JSON.stringify(o)))}function y(e){var n=u(e.url);e.agentPageUrl&&($[n]=e.agentPageUrl);var t={success:e.success||arguments[1]||function(){},error:e.error||arguments[2]||function(){},always:e.always||arguments[3]||function(){}},r=Y();W[n]||(W[n]={}),W[n][r]=t,p(n,d(n),r,e);var o={success:function(e){return t.success=e,o},error:function(e){return t.error=e,o},always:function(e){return t.always=e,o}};return o}function w(n){var t=e(n.url),r=[].slice.call(arguments);return!t||A?o.apply(null,r):G&&!n.withCredentials?i.apply(null,r):y.apply(null,r)}Array.prototype.forEach||(Array.prototype.forEach=function(e){var n,t;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=arguments[1]),t=0;t<o;){var a;t in r&&(a=r[t],e.call(n,a,t,r)),t++}});var h=function(){var e=0;return function(){return e++}}(),g=function(e){return"number"==typeof e},m=function(e){var n=parseInt(e);return!isNaN(n)&&(("number"==typeof e||"string"==typeof e)&&n==e)},v=function(e){return"string"==typeof e},N=function(e){return"function"==typeof e},T=function(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)},E=function(e){return"[object Array]"===Object.prototype.toString.call(e)},O=function(e){return null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"function"==typeof e},x=function(e){return"function"==typeof Node&&e instanceof Node},b=function(e){return e instanceof NamedNodeMap},C=function(e,n,t){if(T(e)){for(var r in e)if(e.hasOwnProperty(r)&&!1===(u=n(e[r],r)))break}else if(E(e))if(t)for(o=e.length-1;o>=0&&!1!==(u=n(e[o],o));o--);else for(var o=0,a=e.length;o<a&&!1!==(u=n(e[o],o));o++);else if(x(e)){var i=!1;switch(e.nodeType){case Node.ELEMENT_NODE:break;case Node.TEXT_NODE:case Node.COMMENT_NODE:case Node.PROCESSING_INSTRUCTION_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_TYPE_NODE:case Node.DOCUMENT_FRAGMENT_NODE:default:i=!0}if(i)return;for(var o=0,s=e.childNodes,a=e.childNodes.length;o<a;o++)n(s[o]),C(s[o],n)}else if(b(e))for(var o=0,a=e.length;o<a;o++){var u=n(e[o].nodeValue,e[o].nodeName);if(!1===u)break}else N(e.forEach)&&e.forEach(n)},S=function(e){var n=e;return T(e)?(n={},C(e,function(e,t){n[t]=S(e)})):E(e)&&(n=[],C(e,function(e){n.push(S(e))})),n},M=function(e,n){if(T(e))return e.hasOwnProperty(n);if(E(e)){var t=parseInt(n);return m(n)&&e.length>t&&t>=0}return!1},j=function(e,n,t){var r=v(n)||g(n),o=r?e[n]:e;(T(o)||E(o))&&(C(o,function(e,n){j(o,n)}),E(o)&&D(o)),r&&(e[n]=t)},D=function(e,n){if(g(n))for(C(e,function(t,r){if(!(r>=n))return!1;e.length--},!0);e.length<n;)e.push(null);else C(e,function(n,t){n===undefined&&e.length--},!0);return e},L=function(e,n,t){function r(e,n,t){T(n)&&(C(n,function(n,o){!M(e,o)||O(n)?e[o]!==n&&(e[o]=S(n)):r(e[o],n,t)}),t&&(C(e,function(t,r){M(n,r)||j(e,r)}),E(e)&&D(e)))}if(!T(e))return null;var o=Array.prototype.slice.call(arguments,1,!0===arguments[arguments.length-1]?arguments.length-1:arguments.length);return t=!0===arguments[arguments.length-1],C(o,function(n){r(e,n,t)}),e},R=function(e){if(null===e)return"null";if(e===undefined)return"undefined";var n=Object.prototype.toString.call(e);return n.substring("[object ".length,n.length-1).toLowerCase()},X=function(e){if(null==e)return"";if("array"===R(e))return JSON.stringify(e);if(O(e))return String(e);var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(O(e[t])?String(e[t]):JSON.stringify(e[t])));return n.join("&")},_=window.ActiveXObject===undefined||window.document.documentMode>8?n:function(){return n()||t()},P={},I={type:"GET",url:null,data:{},headers:{"Content-type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},responseType:"text",withCredentials:!1};window.attachEvent&&window.attachEvent("onunload",function(){for(var e in P)P.hasOwnProperty(e)&&P[e](undefined,!0)});var J=_(),A=!!J&&"withCredentials"in J,U=/^(https?:)?\/\//i,q=/^get|post$/i,k=new RegExp("^(//|"+window.location.protocol+")","i"),B={type:"GET",url:null,data:{},responseType:"text"},G=!!window.XDomainRequest,H={},W={},$={},F={},V={},Y=function(){var e=0;return function(){return++e}}();!function(e,n,t){t=t||window,window.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)}("message",function(e){var n;try{n=JSON.parse(e.data)}catch(r){}if(n)switch(n.type){case"iframe-agent-ready":F[n.origin]=!0;var t=window.document.getElementById(f(n.origin));V[n.origin]&&(V[n.origin].forEach(function(e){t.contentWindow.postMessage(e,n.origin)}),V[n.origin].length=0),delete V[n.origin];break;case"iframe-agent-response":null!=n.id&&W[n.origin][n.id]&&("success"===n.message?W[n.origin][n.id].success.apply(null,n.data):"error"===n.message&&W[n.origin][n.id].error.apply(null,n.data),W[n.origin][n.id].always&&W[n.origin][n.id].always.apply(null,n.data),delete W[n.origin][n.id])}});return function(e){var n=[].slice.call(arguments);return e.jsonp?s.apply(null,n):w.apply(null,n)}});
