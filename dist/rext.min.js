!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.rext=t()}(this,function(){"use strict";function e(e){var t=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,n=t.exec(window.location.href.toLowerCase())||[],r=t.exec(e.toLowerCase());return!(!r||r[1]===n[1]&&r[2]===n[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(n[3]||("http:"===n[1]?"80":"443")))}function t(){try{return new window.XMLHttpRequest}catch(e){}}function n(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function r(e){var t;if("text"!==e.responseType&&""!==e.responseType)return e.response;try{t=JSON.parse(e.responseText)}catch(n){t=e.responseText}return t}function o(e){var t=L({},P,e||{}),n=w(),o={success:e.success||arguments[1]||function(){},error:e.error||arguments[2]||function(){},always:e.always||arguments[3]||function(){}},a=X(),i=function(e,t){if(null!=i&&(4===a.readyState||t))if(delete _[n],i=undefined,a.onreadystatechange=null,t)4!==a.readyState&&a.abort();else{var s=r(a);a.status>=200&&a.status<300?o.success.call(o,s,a):o.error.call(o,s,a),o.always.call(o,s,a)}},s="string"==typeof t.type&&"get"!==t.type.toLowerCase(),u=R(t.data);a.open(t.type,s||!u?t.url:t.url+(t.url.indexOf("?")>0?"&":"?")+u,!0),a.responseType=t.responseType;for(var c in t.headers)t.headers.hasOwnProperty(c)&&a.setRequestHeader(c,t.headers[c]);t.withCredentials&&(a.withCredentials=!0),s?a.send(/application\/json/i.test(t.headers["Content-Type"])?JSON.stringify(t.data):u):a.send(""),4===a.readyState?window.setTimeout(i):a.onreadystatechange=_[n]=i;var l={success:function(e){return o.success=e,l},error:function(e){return o.error=e,l},always:function(e){return o.always=e,l},abort:function(){i&&i(undefined,!0)}};return l}function a(e){var t;try{t=JSON.parse(e)}catch(n){t=e}return t}function i(e){if(e=L({},k,e||{}),U.test(e.type)&&A.test(e.url)&&q.test(e.url)){var t=(e.responseType||"json").toLowerCase(),n=new XDomainRequest;/^\d+$/.test(e.timeout)&&(n.timeout=e.timeout);var r={success:e.success||function(){},error:e.error||function(){},always:e.always||function(){}},o={success:function(e){return r.success=e,o},error:function(e){return r.error=e,o},always:function(e){return r.always=e,o},abort:function(){n.abort()}};n.ontimeout=function(){var e={status:{code:500,message:"timeout"}};r.error.call(r,null,e),r.always.call(r,null,e)},n.onprogress=function(){},n.onload=function(){var e={code:200,message:"success"},o={headers:{"Content-Length":n.responseText.length,"Content-Type":n.contentType},text:n.responseText,data:a(n.responseText)};if("html"===t||/text\/html/i.test(n.contentType))o.data=n.responseText;else if("json"===t||"text"!==t&&/\/json/i.test(n.contentType))try{o.data=JSON.parse(n.responseText)}catch(s){e.code=500,e.message="parser error: invalid json"}else if("xml"===t||"text"!==t&&/\/xml/i.test(n.contentType)){var i=new ActiveXObject("Microsoft.XMLDOM");i.async="false";try{i.loadXML(n.responseText)}catch(s){i=undefined}i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||(e.code=500,e.message="parser error: invalid xml"),o.data=i}o.status=e,e.code>=200&&e.code<300?r.success.call(r,o.data,o):r.error.call(r,o.data,o),r.always.call(r,o.data,o)},n.onerror=function(){var e=[n.responseText,{status:{code:500,message:"error"},text:n.responseText}];r.error.apply(r,e),r.always.apply(r,e)};var i="string"==typeof e.type&&"get"!==e.type.toLowerCase(),s=R(e.data);return n.open(e.type,i||!s?e.url:e.url+(e.url.indexOf("?")>0?"&":"?")+s),window.setTimeout(function(){n.send(i?s:"")},0),o}}function s(e,t){var n="jsonp_"+String(1e3*(new Date).getTime()+Math.round(1e3*Math.random()));window[n]=t||e.callback;var r=window.document.getElementsByTagName("script")[0],o=window.document.createElement("script");if(o.src=e.url+(e.url.indexOf("?")>=0?"&":"?")+R(e.data)+"&callback="+n,r.parentNode.insertBefore(o,r),o.onload=o.onreadystatechange=function(){o.readyState&&!/loaded|complete/.test(o.readyState)||(o.onload=o.onreadystatechange=null,o.parentNode&&o.parentNode.removeChild(o),o=null)},null==window[n])return function(e){window[n]=e}}function u(e){var t=window.document.createElement("a");return t.href=e,t.protocol+"//"+t.host}function c(e){return G[e]===undefined&&(G[e]=V()),G[e]}function l(e){return F[e]===undefined&&(F[e]=e+"/iframe-agent.html"),F[e]}function d(e){return"iframe-agent-"+c(e)}function f(e){var t=d(e),n=window.document.getElementById(t);n||((n=window.document.createElement("iframe")).id=t,n.style.display="none",window.document.body.appendChild(n));var r=l(e);return n.src!==r&&(n.src=r),n}function p(e,t,n,r){var o={type:"iframe-agent-request",origin:e,id:n,data:r};W[e]?t.contentWindow.postMessage(JSON.stringify(o),e):($[e]||($[e]=[]),$[e].push(JSON.stringify(o)))}function y(e){var t=u(e.url);e.agentPageUrl&&(F[t]=e.agentPageUrl);var n={success:e.success||arguments[1]||function(){},error:e.error||arguments[2]||function(){},always:e.always||arguments[3]||function(){}},r=V();H[t]||(H[t]={}),H[t][r]=n,p(t,f(t),r,e);var o={success:function(e){return n.success=e,o},error:function(e){return n.error=e,o},always:function(e){return n.always=e,o}};return o}Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,n;if(null==this)throw new TypeError("this is null or not defined");var r=Object(this),o=r.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(t=arguments[1]),n=0;n<o;){var a;n in r&&(a=r[n],e.call(t,a,n,r)),n++}});var w=function(){var e=0;return function(){return e++}}(),h=function(e){return"number"==typeof e},g=function(e){var t=parseInt(e);return!isNaN(t)&&(("number"==typeof e||"string"==typeof e)&&t==e)},m=function(e){return"string"==typeof e},T=function(e){return"function"==typeof e},v=function(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)},N=function(e){return"[object Array]"===Object.prototype.toString.call(e)},E=function(e){return null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"function"==typeof e},O=function(e){return"function"==typeof Node&&e instanceof Node},x=function(e){return e instanceof NamedNodeMap},C=function(e,t,n){if(v(e)){for(var r in e)if(e.hasOwnProperty(r)&&!1===(u=t(e[r],r)))break}else if(N(e))if(n)for(o=e.length-1;o>=0&&!1!==(u=t(e[o],o));o--);else for(var o=0,a=e.length;o<a&&!1!==(u=t(e[o],o));o++);else if(O(e)){var i=!1;switch(e.nodeType){case Node.ELEMENT_NODE:break;case Node.TEXT_NODE:case Node.COMMENT_NODE:case Node.PROCESSING_INSTRUCTION_NODE:case Node.DOCUMENT_NODE:case Node.DOCUMENT_TYPE_NODE:case Node.DOCUMENT_FRAGMENT_NODE:default:i=!0}if(i)return;for(var o=0,s=e.childNodes,a=e.childNodes.length;o<a;o++)t(s[o]),C(s[o],t)}else if(x(e))for(var o=0,a=e.length;o<a;o++){var u=t(e[o].nodeValue,e[o].nodeName);if(!1===u)break}else T(e.forEach)&&e.forEach(t)},b=function(e){var t=e;return v(e)?(t={},C(e,function(e,n){t[n]=b(e)})):N(e)&&(t=[],C(e,function(e){t.push(b(e))})),t},j=function(e,t){if(v(e))return e.hasOwnProperty(t);if(N(e)){var n=parseInt(t);return g(t)&&e.length>n&&n>=0}return!1},S=function(e,t,n){var r=m(t)||h(t),o=r?e[t]:e;(v(o)||N(o))&&(C(o,function(e,t){S(o,t)}),N(o)&&M(o)),r&&(e[t]=n)},M=function(e,t){if(h(t))for(C(e,function(n,r){if(!(r>=t))return!1;e.length--},!0);e.length<t;)e.push(null);else C(e,function(t,n){t===undefined&&e.length--},!0);return e},L=function(e,t,n){function r(e,t,n){v(t)&&(C(t,function(t,o){!j(e,o)||E(t)?e[o]!==t&&(e[o]=b(t)):r(e[o],t,n)}),n&&(C(e,function(n,r){j(t,r)||S(e,r)}),N(e)&&M(e)))}if(!v(e))return null;var o=Array.prototype.slice.call(arguments,1,!0===arguments[arguments.length-1]?arguments.length-1:arguments.length);return n=!0===arguments[arguments.length-1],C(o,function(t){r(e,t,n)}),e},D=function(e){if(null===e)return"null";if(e===undefined)return"undefined";var t=Object.prototype.toString.call(e);return t.substring("[object ".length,t.length-1).toLowerCase()},R=function(e){if(null==e)return"";if("array"===D(e))return JSON.stringify(e);if(E(e))return String(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(E(e[n])?String(e[n]):JSON.stringify(e[n])));return t.join("&")},X=window.ActiveXObject===undefined||window.document.documentMode>8?t:function(){return t()||n()},_={},P={type:"GET",url:null,data:{},headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},responseType:"text",withCredentials:!1};window.attachEvent&&window.attachEvent("onunload",function(){for(var e in _)_.hasOwnProperty(e)&&_[e](undefined,!0)});var I=X(),J=!!I&&"withCredentials"in I,A=/^(https?:)?\/\//i,U=/^get|post$/i,q=new RegExp("^(//|"+window.location.protocol+")","i"),k={type:"GET",url:null,data:{},responseType:"text"},B=!!window.XDomainRequest,G={},H={},F={},W={},$={},V=function(){var e=0;return function(){return++e}}();return function(e,t,n){n=n||window,window.addEventListener?n.addEventListener(e,t,!1):n.attachEvent("on"+e,t)}("message",function(e){var t;try{t=JSON.parse(e.data)}catch(r){}if(t)switch(t.type){case"iframe-agent-ready":W[t.origin]=!0;var n=window.document.getElementById(d(t.origin));$[t.origin]&&($[t.origin].forEach(function(e){n.contentWindow.postMessage(e,t.origin)}),$[t.origin].length=0),delete $[t.origin];break;case"iframe-agent-response":null!=t.id&&H[t.origin][t.id]&&("success"===t.message?H[t.origin][t.id].success.apply(null,t.data):"error"===t.message&&H[t.origin][t.id].error.apply(null,t.data),H[t.origin][t.id].always&&H[t.origin][t.id].always.apply(null,t.data),delete H[t.origin][t.id])}}),function(t){var n=[].slice.call(arguments);if(t.jsonp||"jsonp"===t.dataType||"jsonp"===t.responseType)return s.apply(null,n);var r=e(t.url),a=!!t.withCredentials||t.xhrFields&&!!t.xhrFields.withCredentials;t.withCredentials=a,t.type||"string"!=typeof t.method||(t.type=t.method),"string"!=typeof t.type&&(t.type="get"),t.type=t.type.toLowerCase();var u="get"!==t.type;t.headers||(t.headers={}),t.contentType&&(t.headers["Content-Type"]?delete t.contentType:t.headers["Content-Type"]=t.contentType),t.headers["Content-Type"]||(t.headers["Content-Type"]="application/x-www-form-urlencoded"),"string"!=typeof t.responseType&&("string"==typeof t.dataType&&/^(text|json|xml|html)$/i.test(t.dataType)?t.responseType=t.dataType:t.responseType="text"),t.complete&&(t.always=t.complete,delete t.complete);var c=!!t.agent;return!r||J?o.apply(null,n):c||!B||a||u||/\/json/i.test(t.headers["Content-Type"])?y.apply(null,n):i.apply(null,n)}});
